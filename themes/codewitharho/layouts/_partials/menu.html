{{- /*
Renders a menu for the given menu ID.

@context {page} page The current page.
@context {string} menuID The menu ID.

@example: {{ partial "menu.html" (dict "menuID" "main" "page" .) }}
*/}}

{{- $page := .page }}
{{- $menuID := .menuID }}

{{- with index site.Menus $menuID }}
  <nav class="fixed top-0 left-0 w-full bg-white dark:bg-gray-900 dark:border-b dark:border-b-gray-700 shadow z-50 transition-transform duration-300">
    <div class="relative max-w-6xl mx-auto flex items-center px-4 py-3">

      <button id="menu-toggle" class="md:hidden p-1 text-gray-800 dark:text-gray-200" aria-label="Toggle menu" aria-expanded="false" aria-controls="mobile-menu">
        <span id="icon-menu-open">{{ partial "icon.html" (dict "name" "menu" "class" "w-5 h-5") }}</span>
        <span id="icon-menu-close" class="hidden">{{ partial "icon.html" (dict "name" "x" "class" "w-5 h-5") }}</span>
      </button>

      <a href="/" class="font-bold text-xl no-underline text-gray-900 dark:text-gray-100 absolute left-1/2 -translate-x-1/2 md:static md:translate-x-0 md:mr-8">
        Shouldn't Be Hard
      </a>

      <ul class="hidden md:flex space-x-6 list-none m-0 p-0">
        {{- partial "inline/menu/walk.html" (dict "page" $page "menuEntries" .) }}
      </ul>

      <div class="ml-auto flex items-center">
        <button id="search-toggle" class="p-2 text-gray-800 dark:text-gray-200 hover:text-gray-600 dark:hover:text-gray-400 transition-colors" aria-label="Open search">
          {{ partial "icon.html" (dict "name" "search" "class" "w-5 h-5") }}
        </button>
        <button id="theme-toggle" class="p-2 text-gray-800 dark:text-gray-200" aria-label="Toggle dark mode">
          {{ partial "icon.html" (dict "name" "moon" "class" "dark:hidden w-5 h-5") }}
          {{ partial "icon.html" (dict "name" "sun" "class" "hidden dark:inline w-5 h-5") }}
        </button>
      </div>
    </div>

    <div id="mobile-menu" class="hidden md:hidden border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900">
      <ul class="flex flex-col list-none m-0 p-0 px-4 py-2">
        {{- partial "inline/menu/walk.html" (dict "page" $page "menuEntries" .) }}
      </ul>
    </div>
  </nav>
{{- end }}

{{- define "_partials/inline/menu/walk.html" }}
  {{- $page := .page }}
  {{- range .menuEntries }}
    {{- $attrs := dict "href" .URL }}
    {{- if $page.IsMenuCurrent .Menu . }}
      {{- $attrs = merge $attrs (dict "class" "active" "aria-current" "page") }}
    {{- else if $page.HasMenuCurrent .Menu .}}
      {{- $attrs = merge $attrs (dict "class" "ancestor" "aria-current" "true") }}
    {{- end }}
    {{- $name := .Name }}
    {{- with .Identifier }}
      {{- with T . }}
        {{- $name = . }}
      {{- end }}
    {{- end }}
    <li>
      <a class="no-underline text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"
        {{- range $k, $v := $attrs }}
          {{- with $v }}
            {{- printf " %s=%q" $k $v | safeHTMLAttr }}
          {{- end }}
        {{- end -}}
      >{{ $name }}</a>
      {{- with .Children }}
        <ul>
          {{- partial "inline/menu/walk.html" (dict "page" $page "menuEntries" .) }}
        </ul>
      {{- end }}
    </li>
  {{- end }}
{{- end }}